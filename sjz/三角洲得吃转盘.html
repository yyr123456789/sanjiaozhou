<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ä¸‰è§’æ´²</title>
<style>
  body {
    font-family: "å¾®è½¯é›…é»‘", "SimHei", sans-serif;
    text-align: center;
    margin: 0; padding: 20px;
    background: #f9f9f9;
  }
  .wheel-container {
    display: inline-block;
    margin: 20px;
    vertical-align: top;
  }
  canvas {
    background: white;
    border: 3px solid #333;
    border-radius: 50%;
    display: block;
    margin: 0 auto;
  }
  button {
    margin-top: 10px;
    font-size: 16px;
    padding: 8px 20px;
    cursor: pointer;
  }
  .result {
    margin-top: 8px;
    font-size: 18px;
    color: #d33;
    font-weight: bold;
    min-height: 30px;
  }
</style>
</head>
<body>
<h1>ğŸ¡ ä¸‰è§’æ´²</h1>

<div class="wheel-container">
  <canvas id="wheel1" width="300" height="300"></canvas>
  <button id="spin1">å¼€å§‹è½¬ç›˜1</button>
  <div id="result1" class="result"></div>
</div>

<div class="wheel-container">
  <canvas id="wheel2" width="300" height="300"></canvas>
  <button id="spin2">å¼€å§‹è½¬ç›˜2</button>
  <div id="result2" class="result"></div>
</div>

<div class="wheel-container">
  <canvas id="wheel3" width="300" height="300"></canvas>
  <button id="spin3">å¼€å§‹è½¬ç›˜3</button>
  <div id="result3" class="result"></div>
</div>

<script>
class SpinningWheel {
  constructor(canvasId, options, resultId, buttonId) {
    this.options = options;
    this.canvas = document.getElementById(canvasId);
    this.ctx = this.canvas.getContext("2d");
    this.centerX = this.canvas.width / 2;
    this.centerY = this.canvas.height / 2;
    this.radius = 130;
    this.segmentAngle = 2 * Math.PI / this.options.length;
    this.colors = [
      "#FF9999", "#99CCFF", "#99FF99", "#FFCC99", "#CC99FF", "#FFFF99", "#FF9966", "#66CC99"
    ];
    // æ‰©å±•é¢œè‰²æ•°ç»„ä»¥é˜²æ­¢é¢œè‰²ä¸è¶³
    while (this.colors.length < this.options.length) {
      this.colors.push('#'+Math.floor(Math.random()*16777215).toString(16));
    }

    this.startAngle = 0;
    this.isSpinning = false;
    this.spinTimeout = null;
    this.spinSpeed = 0;
    this.deceleration = 0.97;

    this.resultElem = document.getElementById(resultId);
    this.button = document.getElementById(buttonId);
    this.button.addEventListener("click", () => this.startSpin());

    this.drawWheel(this.startAngle);
  }

  drawWheel(angle) {
    const ctx = this.ctx;
    ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);

    for (let i = 0; i < this.options.length; i++) {
      const angleStart = angle + i * this.segmentAngle;
      const angleEnd = angleStart + this.segmentAngle;

      // æ‰‡å½¢
      ctx.fillStyle = this.colors[i % this.colors.length];
      ctx.beginPath();
      ctx.moveTo(this.centerX, this.centerY);
      ctx.arc(this.centerX, this.centerY, this.radius, angleStart, angleEnd);
      ctx.closePath();
      ctx.fill();

      // æ–‡å­—
      ctx.save();
      ctx.fillStyle = "#000";
      ctx.translate(this.centerX, this.centerY);
      ctx.rotate(angleStart + this.segmentAngle / 2);
      ctx.textAlign = "right";
      ctx.font = "14px SimHei, sans-serif";
      ctx.fillText(this.options[i], this.radius - 10, 10);
      ctx.restore();
    }

    // ä¸­å¿ƒåœ†
    ctx.beginPath();
    ctx.arc(this.centerX, this.centerY, 30, 0, 2 * Math.PI);
    ctx.fillStyle = "#fff";
    ctx.fill();
    ctx.lineWidth = 3;
    ctx.stroke();

    // æŒ‡é’ˆï¼ˆçº¢è‰²ä¸‰è§’å½¢ï¼Œé¡¶éƒ¨ä¸­é—´ï¼Œå°–å¤´æœä¸‹ï¼‰
    ctx.fillStyle = "red";
    ctx.beginPath();
    ctx.moveTo(this.centerX - 15, this.centerY - this.radius - 10);
    ctx.lineTo(this.centerX + 15, this.centerY - this.radius - 10);
    ctx.lineTo(this.centerX, this.centerY - this.radius + 20);
    ctx.closePath();
    ctx.fill();
  }

  startSpin() {
    if (this.isSpinning) return;
    this.isSpinning = true;
    this.resultElem.textContent = "æ—‹è½¬ä¸­...";
    this.spinSpeed = Math.random() * 0.3 + 0.25;
    this.spin();
  }

  spin() {
    if (this.spinSpeed <= 0.01) {
      clearTimeout(this.spinTimeout);
      this.isSpinning = false;
      this.showResult();
      return;
    }
    this.startAngle += this.spinSpeed;
    this.startAngle %= 2 * Math.PI;
    this.drawWheel(this.startAngle);
    this.spinSpeed *= this.deceleration;
    this.spinTimeout = setTimeout(() => this.spin(), 30);
  }

  showResult() {
    // æŒ‡é’ˆå›ºå®šåœ¨é¡¶éƒ¨ï¼ˆè§’åº¦0ï¼Œå‘ä¸Šï¼‰
    // è®¡ç®—å½“å‰æŒ‡å‘çš„æ‰‡åŒºindex
    const selectedAngle = (3 * Math.PI / 2 - this.startAngle + 2 * Math.PI) % (2 * Math.PI);
    const selectedIndex = Math.floor(selectedAngle / this.segmentAngle) % this.options.length;
    const resultText = this.options[selectedIndex];
    this.resultElem.textContent = `ğŸ¯ ç»“æœï¼š${resultText}`;
  }
}

const wheel1Options = ["æœºå¯†å¤§å", "æœºå¯†é•¿å¼“", "æœºå¯†å·´å…‹ä»€", "æœºå¯†èˆªå¤©", "ç»å¯†å·´å…‹ä»€", "ç»å¯†èˆªå¤©", "ç»å¯†ç›‘ç‹±"];
const wheel2Options = ["ä¸‰å¥—", "å››å¥—", "äº”å¥—", "å…­å¥—"];
const wheel3Options = ["ç»¿å¼¹", "è“å¼¹", "ç´«å¼¹", "é‡‘å¼¹"];

const wheel1 = new SpinningWheel("wheel1", wheel1Options, "result1", "spin1");
const wheel2 = new SpinningWheel("wheel2", wheel2Options, "result2", "spin2");
const wheel3 = new SpinningWheel("wheel3", wheel3Options, "result3", "spin3");
</script>
</body>
</html>
